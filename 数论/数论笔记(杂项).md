
# 勒让德公式
---

勒让德公式是什么
-----------

勒让德公式用来算**质数 \(p\) 在阶乘 \(n!\) 的质因子分解中的指数**。  
公式是：

\[
v_p(n!) = \sum_{k=1}^{\infty} \left\lfloor \frac{n}{p^k} \right\rfloor,
\]

其中 \(v_p(n!)\) 表示 \(p\) 在 \(n!\) 里出现的次数（指数）。

---

为什么成立
--------

考虑 \(n! = 1 \cdot 2 \cdot 3 \cdots n\)。

* 每隔 \(p\) 个数里有一个能被 \(p\) 整除，所以至少有 \(\lfloor n/p \rfloor\) 个因子 \(p\)；
* 每隔 \(p^2\) 个数里有一个能被 \(p^2\) 整除，它会额外贡献一个 \(p\)，所以再加 \(\lfloor n/p^2 \rfloor\)；
* 每隔 \(p^3\) 个数里有一个能被 \(p^3\) 整除，它会再额外贡献一个 \(p\)……  
  如此类推，直到 \(p^k > n\) 为止。

所以总和就是上面的式子。

---

一个例子
-------

算 \(v_2(10!)\)：

\[
\lfloor 10/2 \rfloor + \lfloor 10/4 \rfloor + \lfloor 10/8 \rfloor = 5 + 2 + 1 = 8.
\]

验证：  
\(10! = 3628800 = 2^8 \cdot 3^4 \cdot 5^2 \cdot 7\). 

---
在这题里的作用
-----------

我们要计算：

\[
C_n = \frac{1}{n+1} \binom{2n}{n}.
\]

其中涉及到阶乘：  
\(\binom{2n}{n} = \frac{(2n)!}{(n!)^2}\)。

为了在**任意模数 \(p\)** 下算出结果（尤其是 \(p\) 不是质数时），不能用逆元，要直接做**质因子分解**。  
于是对每个质数 \(q\)，用勒让德公式求它在 \((2n)!\)、\(n!\) 中的指数差，得到 \(q\) 在组合数中的幂次。

再减去 \(n+1\) 的质因子指数，就是卡特兰数的质因子分解。最后用快速幂拼起来，就得到答案 \(\bmod p\)。

