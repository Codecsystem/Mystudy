# 圆排列

\( n \) 个不同元素围成一圈的**圆排列数**，记作 \( Q_n^n \)。

考虑其中已经排好的一圈，从不同位置断开，会变成 \( n \) 个不同的线排列：  
\[ Q_n^n \times n = A_n^n \]  
则  
\[ Q_n^n = \frac{A_n^n}{n} = (n-1)! \]

例如，3 个不同元素的圆排列数为 \((3-1)! = 2\) 种：

从 \( n \) 个不同元素中选 \( m \) 个围成一圈的**圆排列数**，记作 \( Q_n^m \)：  
\[ 
    Q_n^m = C_n^m \cdot Q_m^m = \frac{n!}{m \cdot (n-m)!}
\]
>其实就是全排列固定了一个数

# 错位排列

错位排列是没有任何元素出现在其有序位置的排列。对于 \(1 \sim n\) 的排列 \(P\)，如果满足 \(P_i \neq i\)，则称 \(P\) 是 \(n\) 的错位排列。

## 错位排列数
- \(D_1 = 0\)
- \(D_2 = 1\)（即 \(\{2,1\}\)）
- \(D_3 = 2\)（即 \(\{2,3,1\},\{3,1,2\}\)）
- \(D_4 = 9\)（即 \(\{2,1,4,3\},\{2,3,4,1\},\{2,4,1,3\},\{3,1,4,2\},\{3,4,1,2\},\{3,4,2,1\},\{4,1,2,3\},\{4,3,1,2\},\{4,3,2,1\}\)）

---

### 递推关系 \(D_n = (n-1)(D_{n-1} + D_{n-2})\)
**边界条件**：
\[
D_1 = 0, \quad D_2 = 1
\]

| \(n\) | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|-------|---|---|---|---|---|---|---|---|
| \(D_n\) | 0 | 1 | 2 | 9 | 44 | 265 | 1854 | 14833 |

---

## 信封问题
\(n\) 封不同的信（编号 \(1,2,\dots,n\)）放入 \(n\) 个编号对应的信封中，要求每个信封的编号与信的编号都不相同。有多少种放置方法？

### 递推关系分析
考虑第 \(n\) 封信的放置：
1. **情况1**：前 \(n-1\) 封信已全错排  
   - 第 \(n\) 封信只需与前面任一封信交换位置  
   - 方法数：\((n-1) \cdot D_{n-1}\)

2. **情况2**：前 \(n-1\) 封信恰好有 1 封位置正确  
   - 第 \(n\) 封信必须与位置正确的信交换  
   - 方法数：\((n-1) \cdot D_{n-2}\)

> 其他情况无法通过一次交换变成全错排

# 第一类斯特林数（斯特林轮换数）

将 \( n \) 个不同元素划分为 \( m \) 个非空圆排列的方案数，  
记作 \( S(n, m) \) 或：
\[
\begin{bmatrix}
n \\
m
\end{bmatrix}
\]

## 递推关系
\[
\begin{bmatrix}
n \\
m
\end{bmatrix} = 
\begin{bmatrix}
n-1 \\
m-1
\end{bmatrix} + (n-1)
\begin{bmatrix}
n-1 \\
m
\end{bmatrix}
\]

---

## 组合解释（圆桌问题）
\( n \) 个人坐 \( m \) 张圆桌的方案数，考虑第 \( n \) 个人的两种坐法：

1. **单独坐一桌**  
   - 前 \( n-1 \) 人坐满剩余的 \( m-1 \) 张桌  
   - 方案数：\(\begin{bmatrix} n-1 \\ m-1 \end{bmatrix}\)

2. **与其他人同坐**  
   - 前 \( n-1 \) 人先坐满 \( m \) 张桌  
   - 第 \( n \) 人可坐到任意 \( n-1 \) 个人的左侧  
   - 方案数：\((n-1) \cdot \begin{bmatrix} n-1 \\ m \end{bmatrix}\)

# 第二类斯特林数（斯特林子集数）

将 \( n \) 个不同元素划分为 \( m \) 个非空子集的方案数，  
记作 \( S(n, m) \) 或：
\[
\left\{ \begin{array}{c} n \\ m \end{array} \right\}
\]

## 递推关系
\[
\left\{ \begin{array}{c} n \\ m \end{array} \right\} = 
\left\{ \begin{array}{c} n-1 \\ m-1 \end{array} \right\} + 
m \left\{ \begin{array}{c} n-1 \\ m \end{array} \right\}
\]

---

## 组合解释（房间分配问题）
\( n \) 个人进入 \( m \) 个房间的方案数（每个房间非空），考虑第 \( n \) 个人的两种选择：

1. **单独进入新房间**  
   - 前 \( n-1 \) 人进入剩余的 \( m-1 \) 个房间  
   - 方案数：\(\left\{ \begin{array}{c} n-1 \\ m-1 \end{array} \right\}\)

2. **进入已有人的房间**  
   - 前 \( n-1 \) 人先进入所有 \( m \) 个房间  
   - 第 \( n \) 人可选择进入任意一个已有人的房间  
   - 方案数：\(m \cdot \left\{ \begin{array}{c} n-1 \\ m \end{array} \right\}\)

# Catalan数 通项公式
(1) \( H_n = C_{2n}^n - C_{2n}^{n-1} \)  
(2) \( H_n = \frac{1}{n+1} C_{2n}^n \)  
(3) \( H_n = \frac{4n-2}{n+1} H_{n-1} \)  
## 证明
![本地图片](./md.img/卡特兰数.png)

## Catalan 数列
| \( H_0 \) | \( H_1 \) | \( H_2 \) | \( H_3 \) | \( H_4 \) | \( H_5 \) | \( H_6 \) | \( H_7 \) | \( H_8 \) |
|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|
| 1         | 1         | 2         | 5         | 14        | 42        | 132       | 429       | 1430      |

## Catalan 特征
从 (0,0) 到 (n,n)，不越过对角线，即任何时候，向上走的步数不能超过向右走的步数。  
一种操作数不能超过另外一种操作数，或者两种操作不能有交集，这些操作的合法方案数，通常是卡特兰数。

## Catalan 应用
1. 一个有 \( n \) 个 0 和 \( n \) 个 1 组成的字串，且所有的前缀字串皆满足 1 的个数不超过 0 的个数。这样的字串个数有多少？  
2. 包含 \( n \) 组括号的合法运算式的个数有多少？  
3. 一个栈的进栈序列为 1,2,3,···, \( n \)，有多少个不同的出栈序列？  
合法性：任何时刻不能空栈出栈 ⇒ 任意前缀“)”不多于“(”；最后入栈、出栈各n次，栈空。
4. \( n \) 个结点可构造多少个不同的二叉树？  
5. 在圆上选择 \( 2n \) 个点，将这些点成对连接起来使得所得的 \( n \) 条弦不相交的方法数？  
6. 通过连结顶点而将 \( n + 2 \) 边的凸多边形分成 \( n \) 个三角形的方法数？

## 说明
这些都是卡特兰数，因为它们都与**合法括号序列 / Dyck 路径**存在天然的双射，或者都满足同一个**卡特兰递推**  
\[
C_0=1,\qquad C_n=\sum_{i=0}^{n-1} C_i\,C_{n-1-i}\ (n\ge1),
\]
并且初值一致，所以计数相同。分别说——

---

### 3) 单栈出栈序列的个数 = \(C_n\)
把栈的操作写成长度 \(2n\) 的串：  
- 入栈记“(”，出栈记“)”。  
合法性：任何时刻不能空栈出栈 ⇒ 任意前缀“)”不多于“(”；最后入栈、出栈各 \(n\) 次。  
这正是**合法括号序列**的定义，因此个数为 \(C_n=\frac1{n+1}\binom{2n}{n}\)。

（同说法：栈可生成的排列=231-避免排列，其数目为卡特兰数。）

---

### 4) \(n\) 个结点的二叉树个数 = \(C_n\)
设 \(T_n\) 为有 \(n\) 个结点（有序、无标号）的二叉树数。以根为界：左子树 \(i\) 个结点、右子树 \(n-1-i\) 个结点，二者独立：
\[
T_n=\sum_{i=0}^{n-1} T_i\,T_{n-1-i},\quad T_0=1.
\]
这恰是卡特兰递推，因此 \(T_n=C_n\)。  
（等价双射：对二叉树做先序/中序边走访，“向下”记“(”，“返回”记“)”，得到 Dyck 串，反之亦然。）

---

### 5) 圆上 \(2n\) 点配对且弦不相交的配法数 = \(C_n\)
固定点 1，它必须与某个点 \(2k\) 相连（顺时针计）。这一条弦把圆分成两侧：  
- 一侧有 \(2k-2\) 个点，可不交配对数 \(C_{k-1}\)；  
- 另一侧有 \(2n-2k\) 个点，可不交配对数 \(C_{n-k}\)。  
枚举 \(k=1..n\) 得
\[
M_n=\sum_{k=1}^{n} C_{k-1}C_{n-k}=\sum_{i=0}^{n-1} C_i C_{n-1-i}.
\]
同初值 \(M_0=1\)，故 \(M_n=C_n\)。

---

### 6) 将凸 \((n+2)\)-边形三角剖分的方法数 = \(C_n\)
固定顶点 1，选一条对角线 \((1,j)\)（\(j=3..n+2\)）。它把多边形分成：  
- 一个 \((j-1)\)-边形（可三角剖分数 \(C_{j-3}\)）；  
- 一个 \((n+3-j)\)-边形（可三角剖分数 \(C_{n-(j-2)}\)）。  
求和得同一递推：
\[
T_n=\sum_{j=3}^{n+2} C_{j-3} C_{n-(j-2)}=\sum_{i=0}^{n-1} C_i C_{n-1-i},\quad T_0=1,
\]
故 \(T_n=C_n\)。

---

## 递推来源
### 从合法括号序列（Dyck 路径）推导
考虑长度 \(2n\) 的合法括号序列：

- 第一个符号必然是“(”。  
- 找到与之匹配的 “)” 位置。假设它在第 \(2k+2\) 个位置（即括号包住了 \(k\) 对括号）。  

于是序列可以分成三部分：  
\[
\text{(} \, \underbrace{S}_{2k\ \text{长度的合法串}} \, \text{)} \, \underbrace{T}_{2(n-k-1)\ \text{长度的合法串}}
\]

- 内部 \(S\) 是一个合法串，长度 \(2k\)，个数 \(C_k\)；  
- 外部 \(T\) 也是一个合法串，长度 \(2(n-k-1)\)，个数 \(C_{n-1-k}\)。  

所以
\[
C_n=\sum_{k=0}^{n-1} C_k \cdot C_{n-1-k}.
\]

这就是递推的来源。



